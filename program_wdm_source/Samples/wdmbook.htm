<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 9">
<meta name=Originator content="Microsoft Word 9">
<link rel=File-List href="./wdmbook_files/filelist.xml">
<title>General Information</title>
<!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:Zoom>150</w:Zoom>
 </w:WordDocument>
</xml><![endif]-->
<style>
<!--
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:black;}
h1
	{margin-right:0in;
	mso-margin-top-alt:auto;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:1;
	font-size:24.0pt;
	font-family:"Times New Roman";
	color:black;
	mso-font-kerning:18.0pt;
	font-weight:bold;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
p
	{margin-right:0in;
	mso-margin-top-alt:auto;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:black;}
code
	{mso-ascii-font-family:"Courier New";
	mso-fareast-font-family:"Courier New";
	mso-hansi-font-family:"Courier New";
	mso-bidi-font-family:"Courier New";}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
@list l0
	{mso-list-id:241183265;
	mso-list-type:hybrid;
	mso-list-template-ids:-612042178 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l0:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:Symbol;}
@list l1
	{mso-list-id:733355727;
	mso-list-type:hybrid;
	mso-list-template-ids:854860748 -1046974500 -320331550 -1017213696 -1044886992 2144231404 962232356 1573015062 -258340818 971564616;}
@list l1:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l2
	{mso-list-id:986326642;
	mso-list-type:hybrid;
	mso-list-template-ids:721187144 1559534396 -156757164 -552832030 439260360 1303429882 -1923848490 -2109317896 -70483248 -418378808;}
@list l2:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l3
	{mso-list-id:1312101208;
	mso-list-type:hybrid;
	mso-list-template-ids:-1369279110 662057106 -1508496086 464715108 1956690824 -621613232 1604851246 1067467436 1355322428 1407348552;}
@list l3:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l4
	{mso-list-id:1539659855;
	mso-list-type:hybrid;
	mso-list-template-ids:1040644702 -1940355024 229279770 -260126984 -1536263594 -1334906232 -93842890 249322298 499168782 -1351609704;}
@list l5
	{mso-list-id:1610969086;
	mso-list-type:hybrid;
	mso-list-template-ids:1330661460 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l5:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:Symbol;}
@list l6
	{mso-list-id:1806392785;
	mso-list-type:hybrid;
	mso-list-template-ids:-601859738 358403806 -1121135942 -1482280922 -1498638862 -815477334 -2070935824 -1478446152 111573930 -1158363118;}
@list l6:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l7
	{mso-list-id:1890990207;
	mso-list-type:hybrid;
	mso-list-template-ids:1499774046 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
<!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="1027"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
<meta name=Template content="C:\Program Files\Microsoft Office\Office\HTML.DOT">
</head>

<body bgcolor=white lang=EN-US link=blue vlink=purple style='tab-interval:.5in'
leftmargin=8>

<div class=Section1>

<h1 align=center style='text-align:center'><i>Programming the Microsoft Windows
Driver Model, Second Edition</i><br>
by Walter Oney <br>
Copyright (©) 1995 - 2003 by Microsoft Corporation <br>
Portions Copyright (©) 2003 by Walter Oney<br>
General Information</h1>

<p>The companion content for <i>Programming the Microsoft Windows Driver Model,
Second Edition</i> contains more than 40 sample drivers and test programs to
illustrate the topics covered by the book. The file you're viewing contains
general information about the disc, as follows:</p>

<p><a href="#samdirs">Directory Structure</a><br>
<a href="#directory">Directory of Sample Programs</a><br>
<a href="#fastinst">Using the FastInst Utility</a><br>
<a href="#wdmbuild">General Instructions for Building WDM Samples</a><br>
<a href="#usermodebuild">General Instructions for Building User-Mode Samples</a><br>
<a href="#usbtest">General Instructions for USB Samples</a><br>
<a href="#wdmwiz">Using WDMWIZ.AWX</a><br>
<a href="#wmi98">WMI Functionality in Windows 98</a><br>
<a href="#legalstuff">Definitions of EULA Terms</a><br>
<a href="#errors">How to Report Errors</a></p>

<h1><a name=samdirs></a>Directory Structure</h1>

<p>The SAMPLES directory on the companion disc contains the setup program for
the sample programs as well as some common tools used by all the samples. If
you elect to install the book samples onto your hard disk, the setup program
will copy those common tools too. If you elect not to install the samples onto
your hard disk, the setup program will nonetheless install some of the common
tools because you won’t otherwise be able to run the samples.</p>

<p>For those book chapters that have sample programs, the companion disc
contains a directory for that chapter. The chapter contains subdirectories for
each sample program. In many cases, there’s a further subdivision into a SYS
directory (containing the WDM driver) and a TEST subdirectory (containing a
simple test program for exercising the driver). For example, Chapter 3 has
three samples: FILEIO, FPUTEST and SEHTEST. The disc therefore has the
following directory structure:</p>

<p style='margin:0in;margin-bottom:.0001pt'><span style='font-size:10.0pt;
font-family:"Courier New";mso-fareast-font-family:"Courier New"'>Chap3<br>
&nbsp;&nbsp;FileIo<br>
&nbsp;&nbsp;&nbsp;&nbsp;Sys<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;objchk<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i386<br>
&nbsp;&nbsp;&nbsp;&nbsp;Test<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Debug<br>
&nbsp;&nbsp;fputest<br>
&nbsp;&nbsp;&nbsp;&nbsp;Sys<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;objchk<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i386<br>
&nbsp;&nbsp;&nbsp;&nbsp;test<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Debug<br>
&nbsp;&nbsp;SehTest<br>
&nbsp;&nbsp;&nbsp;&nbsp;objchk<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i386<o:p></o:p></span></p>

<p>Each sample also has an HTML file that describes the overall purpose of the
sample and contains brief instructions about how to build and test the sample.
Once you’ve installed a particular sample driver, you can easily read this HTML
file by clicking on the &quot;More Info&quot; button in the &quot;Sample
Information&quot; page of the Device Manager’s property page for the sample
device. </p>

<p><b><span style='color:red'>I recommend that you read the information file
before attempting to build, install, or test any sample. There are nuances for
some of the samples that will drive you crazy unless you know about them ahead
of time.<o:p></o:p></span></b></p>

<p><b><span style='color:red'>In addition, each information file contains a
section entitled “What to look for” that explains where in the source code to
find the stuff that the sample attempts to illustrate.<o:p></o:p></span></b></p>

<h1><a name=directory></a>Directory of Sample Programs</h1>

<table border=1 cellspacing=1 cellpadding=0 width=500 style='width:375.0pt;
 mso-cellspacing:.7pt;mso-padding-alt:3.0pt 3.0pt 3.0pt 3.0pt'>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><b><span style='font-size:13.5pt'>Chapter</span></b></p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><b><span style='font-size:13.5pt'>Sample Name</span></b></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><b><span style='font-size:13.5pt'>Brief Description</span></b></p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Chap2</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap2\stupid\stupid.htm">STUPID</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>The most basic possible WDM driver</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap2\InterfaceEnum\InterfaceEnum.htm">INTERFACEENUM</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>How to enumerate registered device interfaces</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Chap3</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="chap3\fileio\fileio.htm">FILEIO</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>File I/O operations (including Win98 workarounds)</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>&nbsp;</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="chap3\sehtest\sehtest.htm">SEHTEST</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Illustrates use of structured exception handler</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p class=MsoNormal>&nbsp;</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="chap3\fputest\fputest.htm">FPUTEST</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Illustrates floating point operations in a WDM driver</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="chap3\resource\resource.htm">RESOURCE</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Illustrates resource access in kernel mode</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap3\bugcheck\bugcheck.htm">BUGCHECK</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>How to generate a bug check (use this to practice reading crash dumps)</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap3\memtest\memtest.htm">MEMTEST</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Determine how much memory can be allocated in one call.</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Chap4</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap4\spinlock\spinlock.htm">SPINLOCK</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>How to use in-stack queued spin locks when they’re available and regular
  spin locks otherwise.</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Chap6</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="chap6\pnpevent\pnpevent.htm">PNPEVENT</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>User-mode PnP events</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>&nbsp;</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="chap6\pnpmon\pnpmon.htm">PNPMON</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Kernel-mode PnP events</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Chap7</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="chap7\pci42\pci42.htm">PCI42</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Simple PIO device using AMCC S5933 chip. Also includes a driver for the
  ISA card that accompanies the AMCC development kit</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>&nbsp;</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="chap7\pktdma\pktdma.htm">PKTDMA</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Simple DMA device using AMCC S5933 chip</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>&nbsp;</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="chap7\scatgath\scatgath.htm">SCATGATH</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>(Untested) driver using new DMA calls for scatter/gather</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Chap8</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap8\wakeup\wakeup.htm">WAKEUP</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Wakeup and USB selective suspend</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>&nbsp;Chap9</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="chap9\evwait\evwait.htm">EVWAIT</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>How to share an event between user mode and kernel mode</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>&nbsp;</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="chap9\ioctl\ioctl.htm">IOCTL</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>How to handle simple DeviceIoControl operations</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>&nbsp;</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="chap9\notify\notify.htm">NOTIFY</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>How to use an asynchronous I/O control operation to notify an application
  when something interesting happens</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Chap10</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="chap10\wmi42\wmi42.htm">WMI42</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>How to implement a simple WMI class</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>&nbsp;</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="chap10\wmiextra\wmiextra.htm">WMIEXTRA</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Advanced WMI functionality</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>&nbsp;Chap11</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap11\mulfunc\mulfunc.htm">MULFUNC</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Nonstandard multifunction device</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Chap12</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap12\feature\feature.htm">FEATURE</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Setting and clearing a feature</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>&nbsp;</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap12\loopback\loopback.htm">LOOPBACK</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Handling bulk transfer endpoints</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>&nbsp;</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap12\usb42\usb42.htm">USB42</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Simple input-only bulk endpoint</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>&nbsp;</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap12\usbint\usbint.htm">USBINT</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Interrupt endpoint management</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>&nbsp;</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap12\usbiso\usbiso.htm">USBISO</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Isochronous endpoint management</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Chap13</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap13\hidfake\hidfake.htm">HIDFAKE</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Non-standard HID minidriver</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Chap14&nbsp;</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap14\piofake\piofake.htm">PIOFAKE</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>How to setup a watchdog timer</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>&nbsp;</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap14\polling\polling.htm">POLLING</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>How to use a system thread to poll a device</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>&nbsp;</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap14\workitem\workitem.htm">WORKITEM</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>How to create an executive work item</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap14\eventlog\EVENTLOG.HTM">EVENTLOG</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>How to log an event</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Chap15</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap15\devprop\devprop.htm">DEVPROP</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Determining device properties in kernel and user modes</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>&nbsp;</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap15\autolaunch\autolaunch.htm">AUTOLAUNCH</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>How to launch an application automatically when the PnP Manager starts your
  device</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap15\samclass\samclass.htm">SAMCLASS</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Device Manager property page provider DLLs for Windows Xp and Windows 98</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>&nbsp;</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap15\Fastinst\fastinst.htm">FASTINST</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Install single device in Windows Xp</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>&nbsp;</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap15\makename\makename.htm">MAKENAME</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>How to generate a unique friendly name during device setup</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="chap15\coinstaller\coinstaller.htm">COINSTALLER</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>A sample co-installer DLL using MFC</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Chap16</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap16\filter\filter.htm">FILTER</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Simple filter driver that just logs IRPs that pass through</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="Chap16\powtrace\powtrace.htm">POWTRACE</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Lower filter for logging power requests</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>AppendixA</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="appendixa\newstub\wdmstub.htm">WDMSTUB</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Stubs for selectected functions missing from Windows 98 (newer lower
  filter version)</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>&nbsp;</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="AppendixA\harderr\harderr.htm">HARDERR</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>How to call IoRaiseInformationalHardError.</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="AppendixA\WdmCheck\WdmCheck.htm">WDMCHECK</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Source for import-checking utility program</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="AppendixA\whichos\whichos.htm">WHICHOS</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>How to determine the operating system version</p>
  </td>
 </tr>
 <tr>
  <td width="16%" valign=top style='width:16.8%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>&nbsp;</p>
  </td>
  <td width="28%" valign=top style='width:28.66%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p><a href="generic\generic.htm">GENERIC</a></p>
  </td>
  <td width="53%" valign=top style='width:53.78%;padding:3.0pt 3.0pt 3.0pt 3.0pt'>
  <p>Generic PnP and Power support for most of my samples</p>
  </td>
 </tr>
</table>

<p><span style='font-size:24.0pt'>&nbsp;<o:p></o:p></span></p>

<h1><a name=fastinst>Using the FastInst Utility</a></h1>

<p><span style='mso-bookmark:fastinst'>The Hardware Wizards in Windows Xp and Windows
98 are slow enough that you’ll quickly want to find a faster way to install new
drivers. I wrote FastInst to speed up this process. </span></p>

<p><span style='mso-bookmark:fastinst'>Suppose you want to install the WDMIDLE
sample from Chapter 8. You can issue these commands at a command prompt (this
example is for Windows 2000 or XP):</span></p>

<p style='margin:0in;margin-bottom:.0001pt'><span style='mso-bookmark:fastinst'><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-font-family:"Courier New"'>C:&gt;<u>cd
%wdmbook% <br>
</u>C:\Wdmbook&gt;<u>fastinst chap8\wdmidle\sys\device.inf<o:p></o:p></u></span></span></p>

<span style='mso-bookmark:fastinst'></span>

<p>Alternatively, select the INF file of interest in Windows Explorer with the
right mouse, and select the “Install using FASTINST” choice from the context
menu. For this to work, you must have checked the related option when you
installed the samples. If you forgot to do that, use the Tools/Folder
Options/File Types page to define an INF-file association with any desired
wording. The command you want depends on the OS:</p>

<p style='margin-left:.5in;text-indent:-.25in;mso-list:l5 level1 lfo2;
tab-stops:list .5in'><![if !supportLists]><span style='font-family:Symbol'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]>In Windows 2000 or XP, you want to execute
%wdmbook%\fastinst.exe.</p>

<p style='margin-left:.5in;text-indent:-.25in;mso-list:l5 level1 lfo2;
tab-stops:list .5in'><![if !supportLists]><span style='font-family:Symbol'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]>In Windows 98 or ME, you want to execute
%wdmbook%\chap15\fastinst\win98\fastinst.exe</p>

<p>FastInst will install the driver files for the first device mentioned in the
model section for the first manufacturer named in the [manufacturer] section.
If you want to override this selection for an INF file that describes multiple
devices, specify the device identifier for the device you want:</p>

<p style='margin:0in;margin-bottom:.0001pt'><span style='font-size:10.0pt;
font-family:"Courier New";mso-fareast-font-family:"Courier New"'>C:\Wdmbook&gt;<u>fastinst
<i>path</i> device-id<o:p></o:p></u></span></p>

<p>FastInst presents a progress dialog to reassure you that something is
happening. The bar is driven simply off a timer and doesn't reflect the actual
progress of the install. You may see the progress bar fill and start over again
a number of times the first you run FastInst in a session. Be patient—the
installation process can be slow even <i>with</i> FastInst in the picture!</p>

<h1><a name=wdmbuild></a><a name=win98inst></a><span style='mso-bookmark:wdmbuild'>General
Instructions for Building WDM Samples</span></h1>

<p><span style='mso-bookmark:wdmbuild'>Each of the sample drivers includes a project
file (with a file extension of DSP) for use with Microsoft Visual Studio 6.0
and the DDK compiler. Most of the driver samples also include a SOURCES file
for use with the standard DDK BUILD utility. You will need the following
software installed on your computer:</span></p>

<ul type=disc>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l6 level1 lfo5;tab-stops:list .5in'><span style='mso-bookmark:
     wdmbuild'>The Windows XP Device Driver Kit, build 2600 (the Released To
     Manufacturing version from around September 7, 2001) or later. All the
     driver projects in these samples use the compiler that ships with the DDK.
     Alternatively, use any version of the .NET DDK.</span></li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l6 level1 lfo5;tab-stops:list .5in'><span style='mso-bookmark:
     wdmbuild'>For some of the samples only, the Windows 98 Device Driver Kit.
     You need the VxD-related headers and libraries from this kit—none of the
     WDM functionality of any of my samples relies on this kit. The Windows
     Millennium files that accompany the XP DDK will not suffice because they
     lack the wdmvxd.clb library.</span></li>
</ul>

<p><span style='mso-bookmark:wdmbuild'>To build a <b>driver</b> project, follow
this procedure:</span></p>

<p style='margin-left:.5in;text-indent:-.25in;mso-list:l7 level1 lfo7;
tab-stops:list .5in'><span style='mso-bookmark:wdmbuild'><![if !supportLists]>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>If you haven’t already done so, use the Advanced tab of My
Computer properties to set several environment variables (note that the setup
program will have done this if you let it):</span></p>

<p style='margin-left:.75in;text-indent:-.25in;mso-list:l0 level1 lfo9;
tab-stops:list .75in'><span style='mso-bookmark:wdmbuild'><![if !supportLists]><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]>WDMBOOK points to the directory where you installed
these samples.</span></p>

<p style='margin-left:.75in;text-indent:-.25in;mso-list:l0 level1 lfo9;
tab-stops:list .75in'><span style='mso-bookmark:wdmbuild'><![if !supportLists]><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]>DDKPATH points to the base directory of the DDK you’re
using. E.g., “C:\winddk\3615”, or whatever.</span></p>

<p style='margin-left:.75in;text-indent:-.25in;mso-list:l0 level1 lfo9;
tab-stops:list .75in'><span style='mso-bookmark:wdmbuild'><![if !supportLists]><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]>SIWPATH points to the directory, if any, where you
installed the Soft-Ice debugger from Numega. If you haven’t installed Soft-Ice,
set this the same as WDMBOOK, which causes the build scripts to use a dummy
NMSYM.BAT file.</span></p>

<p style='margin-left:.75in;text-indent:-.25in;mso-list:l0 level1 lfo9;
tab-stops:list .75in'><span style='mso-bookmark:wdmbuild'><![if !supportLists]><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]>98DDK points to the directory, if any, where you
installed the Windows 98 DDK. Note that you need this DDK for just a few of the
samples, as noted in the respective sample .HTM file.</span></p>

<p style='margin-left:.5in;text-indent:-.25in;mso-list:l7 level1 lfo7;
tab-stops:list .5in'><span style='mso-bookmark:wdmbuild'><![if !supportLists]>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>Open a command prompt.</span></p>

<p style='margin-left:.5in;text-indent:-.25in;mso-list:l7 level1 lfo7;
tab-stops:list .5in'><span style='mso-bookmark:wdmbuild'><![if !supportLists]>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>Set the following environment variables:<br>
</span><span style='mso-bookmark:wdmbuild'><span style='font-family:"Courier New"'>C:&gt;<u>set
path=%ddkpath%\bin\x86;%path%<br>
</u>C:&gt;<u>set include=%ddkpath%\inc\wxp;%ddkpath%\inc\crt;%include%<br>
</u>C:&gt;<u>set lib=%ddkpath%\lib\wxp\i386;%lib%<br>
</u></span>The file <b>netddk.bat</b> in the WDMBOOK directory contains these
commands, by the way.</span></p>

<p style='margin-left:.5in;text-indent:-.25in;mso-list:l7 level1 lfo7;
tab-stops:list .5in'><span style='mso-bookmark:wdmbuild'><![if !supportLists]>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>Issue the command <b>msdev /useenv. </b>This invokes Visual
Studio in such a way that the environment variables you just set are used to
locate executable files, include files, and libraries. Note that the Visual
Studio setup program should have modified your PATH environment to include the
directories needed by MSDEV. If that didn’t occur, look for and execute a file
named VCVARS32.BAT. If <i>that</i> doesn’t work, figure out by trial and error
which directories you need in your path and try again.</span></p>

<p style='margin-left:.5in;text-indent:-.25in;mso-list:l7 level1 lfo7;
tab-stops:list .5in'><span style='mso-bookmark:wdmbuild'><![if !supportLists]>5.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>Use the <b>File/Open Workspace</b> command to open the .DSP
file for the project you want to build.</span></p>

<p style='margin-left:.5in;text-indent:-.25in;mso-list:l7 level1 lfo7;
tab-stops:list .5in'><span style='mso-bookmark:wdmbuild'><![if !supportLists]>6.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>Use the <b>Build </b>menu to build the project. You will be
using the compiler that ships with the DDK, which is required for Xp drivers.</span></p>

<p><span style='mso-bookmark:wdmbuild'><b><span style='color:red'>Project
changes:</span></b> I recommend that you change the project settings to request
the generation of a browsing database (from the Project Settings dialog, select
the Browse Info tab and check the &quot;Build browse info file&quot; check
box). I couldn't do this for you because this option isn't controlled by the
project file I put on the disc.</span></p>

<p><span style='mso-bookmark:wdmbuild'><b><span style='color:red'>DDK changes:</span></b>
From time to time, Microsoft changes the directory organization for the DDK</span>
and/or the options needed for compiling and linking drivers. The FIXPROJ
utility in the WDMBOOK directory will help you modify your driver projects to
cope with these changes.</p>

<p><b><span style='color:red'>Where files end up:</span></b> The drivers built
by the sample projects end up in the OBJCHK_WXP_I386\I386 or
OBJFRE_WXP_I386\I386 subdirectories. This is the same place that BUILD would
put them.</p>

<p>To build a driver using BUILD, open either the checked or free build
environment using the shortcut created when you installed the DDK. Change to
the project directory and issue the command &quot;build -cewz&quot;. If a
directory doesn't contain a SOURCES file, it means that you can't build the
corresponding project using BUILD. For example, BUILD can't cope with a few of
my samples that require different compile options for different files or that
generate a VxD. Additionally, we didn't attempt to make BUILD work for the
user-mode test programs because we figured that even die-hard BUILD users were
prepared to use the Visual C++ integrated development environment for them.</p>

<p>The build scripts for these samples will copy the finished driver to the
Drivers directory and create a symbol file (with an extension of .NMS) for use
by the Numega Soft-Ice/W debugger. The next time you reboot the computer, you
will be running the newly built driver. <b><i><span style='color:red'>None of
my samples has a name that duplicates that of a standard driver file, but you
should check for conflicts with other drivers you may have installed.<o:p></o:p></span></i></b></p>

<p>In Windows XP, use the <a href="#fastinst">FastInst</a> utility to install a
sample driver for the first time. The fastest way to install a newer version of
a driver is to Disable and re-Enable the device in the Device Manager. The
Disable step unloads the current version. The Enable step loads the driver
present in the Drivers directory, which by now will the one you’ve just
rebuilt.</p>

<p>In Windows 98, you can also use <a href="fastinst">FastInst</a>. The fastest
way to replace a driver is to remove it in Device Manager and then reinstall it
using FastInst.</p>

<p><span style='color:red'>If you use two computers,</span> be sure that you
replicate enough of the WDMBOOK tree that the installation of the SAMPLE class
will go smoothly the first time you try it. The easiest way to be sure of this,
of course, is install the samples on both computers.</p>

<h1><a name=usermodebuild></a>General Instructions for Building User-Mode
Samples</h1>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'>Many
of the sample drivers include one or more user-mode components, such as test
programs. Each such component has a project file (with a file extension of DSP)
for use with Microsoft Visual C++ 6.0. If you want to build one of these
components, open the project and use the Build menu command. </p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'>To
build most of the user-mode samples, you will need a current copy of the
Microsoft Platform SDK. Be sure that the Visual C++ directory settings include
the SDK directories. </p>

<p><b><span style='color:red'>Note that you should use Visual C++ 6.0 rather
than the DDK compiler for all user-mode samples. You won’t be able to debug
them in Visual Studio if you use the DDK compiler.<o:p></o:p></span></b></p>

<h1><a name=usbtest></a>General Instructions for USB Samples</h1>

<p>You can test the USB sample drivers (Chap12 directory) if you have a Cypress
Semiconductors EZUSB development board (see <a href="http://www.cypress.com)/">http://www.cypress.com)</a>.
Each of these samples has an EZUSB subdirectory containing the firmware for the
&quot;device&quot; that the driver works with. A pre-built firmware image with
a file extension of .HEX is there.</p>

<p>To install and test a USB sample driver, start with the EZ-USB development
board in its default state. If you’re not sure of the state, press the Reset
button, or unplug and replug the USB connector. Start the EzMr.EXE utility that
comes with the development kit. Use the Download button to download the .HEX
firmware file to the device. This step will change the personality of the board
to match the device that the sample driver expects. The PnP Manager will then
detect the new device and ask you to point to the INF file for the driver. The
INF file for a USB sample is always named DEVICE.INF and is in the SYS
subdirectory for the sample.</p>

<h1><a name=wdmwiz></a>Using WDMWIZ.AWX</h1>

<p>Appendix B contains detailed instructions about how to use WDMWIZ.AWX, which
is the same custom application wizard I used with Microsoft Visual C++ 6.0 to
build the code samples. I deliberately left out the following additional
instructions so it would be easy to change them up until the very last minute.</p>

<p>The Setup program attempts to copy WDMWIZ to the template directory for
Visual Studio. You may need to copy this file by hand, however. The name of
that directory on my computers is <span style='font-family:"Courier New"'>c:\Program
Files\Microsoft Visual Studio\Common\MSDev98\Template</span>. It might be
different on your computer, depending on how you installed Visual C++. After
you copy the file, the Projects tab on the New dialog in Visual Studio will
include a choice labeled WDM Driver Wizard.</p>

<p>WDMWIZ is able to set up most of the project options you need for building a
driver. The custom wizard support in Visual Studio is still missing a couple of
features, though, and you need to modify the project in these minor respects.</p>

<ol start=1 type=1>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l4 level1 lfo12;tab-stops:list .5in'>Close the workspace if it's
     open. From Explorer, right-click on the .DSP file that WDMWIZ created for
     you and select the Fix WDM Driver Project command from the resulting
     context menu. This will run the FixProj utility that Setup installed on
     your computer in order to change the names of the project configurations
     and the output directory structure to better match the DDK. </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l4 level1 lfo12;tab-stops:list .5in'>Open the Project/Settings
     property page. Select the choice &quot;All Configurations&quot; from the
     &quot;Settings For&quot; list.</li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l4 level1 lfo12;tab-stops:list .5in'>Tab to the &quot;Browse
     Info&quot; page and check &quot;Build Browse Info File&quot;. I recommend
     doing this so you can easily locate the declarations of the kernel-mode
     support functions and structures your driver uses.</li>
</ol>

<h1><a name=wmi98></a>WMI Functionality in Windows 98</h1>

<p>You basically can't test Windows Management Instrumentation (WMI)
functionality in the original release of Windows 98, but you can do so in
Windows 98, Second Edition. My samples depend on WMILIB.LIB, which wasn't
shipped with the originally released version of Windows 98. In addition, there
is a bug in the user-mode provider module that makes it impossible to perform
WMI queries to WDM drivers.</p>

<p>The setup program for Windows 98, Second Edition doesn't install the WBEM
core by default. You must install it by hand at some point. To do so:</p>

<ul type=disc>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l3 level1 lfo15;tab-stops:list .5in'>Open Add/Remove Programs in
     the Control Panel, and select the Windows Setup tab. </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l3 level1 lfo15;tab-stops:list .5in'>Within the Internet Tools
     category, indicate that you want to install Web-Based Enterprise Mgmt. </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l3 level1 lfo15;tab-stops:list .5in'>You may need to reboot your
     computer before WMI will work. The setup program doesn't indicate that you
     should, but some testers have reported this as a problem.</li>
</ul>

<h1><a name=legalstuff></a>Definition of EULA Terms</h1>

<p>The End User License Agreement (EULA) to which you agreed when you installed
the sample programs uses two terms for which this document provides the
definition:</p>

<p>The term SAMPLE CODE includes all of the sample programs referred to in the
Directory of Sample Programs earlier in this document. The following modules,
present on the companion disc, are not SAMPLE CODE and therefore may not be
redistributed in any form:</p>

<ul type=disc>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l2 level1 lfo18;tab-stops:list .5in'>WDMWIZ.AWX (But any driver
     you generate by using WDMWIZ shall be considered SAMPLE CODE for purposes
     of the EULA.) </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l2 level1 lfo18;tab-stops:list .5in'>FIXPROJ.EXE </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l2 level1 lfo18;tab-stops:list .5in'>FASTINST.EXE </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l2 level1 lfo18;tab-stops:list .5in'>DEVTEST.EXE and DEVSIM.VXD </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l2 level1 lfo18;tab-stops:list .5in'>SAMCLASS.DLL and
     SAMCLS16.DLL (But any similar DLL that you generate based on my source
     code for your own devices or classes of devices shall be considered SAMPLE
     CODE for purposes of the EULA.) </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l2 level1 lfo18;tab-stops:list .5in'>WDMCHECK.EXE (but any
     similar program and VxD that you generate based on my source code and
     distribute free of charge to anyone shall be considered SAMPLE CODE for
     purposes of the EULA.)</li>
</ul>

<p>The following items of SAMPLE CODE, and any modules having the same names
built, in whole or in part, from SAMPLE CODE, are designated as
Non-Redistributable:</p>

<ul type=disc>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l1 level1 lfo21;tab-stops:list .5in'>GENERIC.SYS </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l1 level1 lfo21;tab-stops:list .5in'>POWCPL.DLL </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l1 level1 lfo21;tab-stops:list .5in'>WDMSTUB.VXD </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l1 level1 lfo21;tab-stops:list .5in'>AUTOLAUNCH.EXE </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l1 level1 lfo21;tab-stops:list .5in'>ALNCH98.EXE </li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l1 level1 lfo21;tab-stops:list .5in'>STARTSERVICE.DLL</li>
</ul>

<p>You may request a separate, royalty-free license to redistribute these
modules by writing directly to the author at <a
href="mailto:waltoney@oneysoft.com">waltoney@oneysoft.com</a>. Please don't
install a file with one of these names on an end-user system except in
accordance with such a license, because you'll probably end up breaking drivers
from other vendors and diminishing the end user experience of the operating
system.</p>

<h1><a name=errors></a>How to Report Errors</h1>

<p>There are errors in the book and in the code samples. If I knew what they
were, they wouldn't be there. But I know there's a bunch of them lurking about.
I maintain an errata page at my own Web site, which you can reach <a
href="http://www.oneysoft.com/">http://www.oneysoft.com</a>. If you discover a
mistake, please send me e-mail at <a href="mailto:waltoney@oneysoft.com">waltoney@oneysoft.com</a>.
Many readers reported mistakes in the first edition, and their diligence
enabled me to make the second edition a better book.</p>

</div>

</body>

</html>
